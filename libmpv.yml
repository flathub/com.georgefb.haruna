name: libmpv
cleanup: [ /include, /lib/pkgconfig, /share/man ]
buildsystem: simple
build-commands: [
  python3 waf configure --prefix=/app --enable-libmpv-shared --disable-cplayer --disable-build-date --disable-oss-audio --disable-alsa,
  python3 waf build,
  python3 waf install
  ]

sources: 
  - type: git
    url: https://github.com/mpv-player/mpv
    tag: v0.32.0
  - type: file
    url: https://waf.io/waf-2.0.12
    sha256: 0979ca87f45928e0d752049ab2f43be8551249be73dc5563b944ec54f8871d1f
    dest-filename: waf
    
modules:
# luajit -------------------------------------------------------------------------------
  - name: luajit
    no-autogen: true
    cleanup: [ /bin, /lib/*.a, /include, /lib/pkgconfig, /share/man ]
    sources: 
    - type: archive
      url: http://luajit.org/download/LuaJIT-2.1.0-beta3.tar.gz
      sha256: 1ad2e34b111c802f9d0cdf019e986909123237a28c746b21295b63c9e785d9c3
    - type: shell
      commands: [ sed -i 's|/usr/local|/app|' ./Makefile ]
      
# libv4l2 -------------------------------------------------------------------------------
  - name: libv4l2
    cleanup: [ /sbin, /bin, /include, /lib/*.la, /lib/*/*.la, /lib*/*/*/*.la, /lib/pkgconfig, /share/man ]
    config-opts: [ --disable-static, --disable-bpf, --with-udevdir=/app/lib/udev ]
    sources: 
    - type: archive
      url: https://linuxtv.org/downloads/v4l-utils/v4l-utils-1.18.0.tar.bz2
      sha256: 6cb60d822eeed20486a03cc23e0fc65956fbc1e85e0c1a7477f68bbd9802880d
      
# nv-codec-headers -------------------------------------------------------------------------------
  - name: nv-codec-headers
    cleanup: ["*"]
    no-autogen: true
    make-install-args: [PREFIX=/app]
    sources: 
    - type: git
      url: https://git.videolan.org/git/ffmpeg/nv-codec-headers.git
      tag: n9.1.23.1
  
# ffmpeg -------------------------------------------------------------------------------
  - name: ffmpeg
    cleanup: [ /include, /lib/pkgconfig, /share/ffmpeg/examples ]
    config-opts: 
    - --enable-shared
    - --disable-static
    - --enable-gnutls
    - --disable-doc
    - --disable-programs
    - --disable-encoders
    - --disable-muxers
    - --enable-encoder=png
    - --enable-libv4l2
    - --enable-libdav1d
    - --enable-libfontconfig
    - --enable-libfreetype
    - --enable-libopus
    - --enable-librsvg
    - --enable-libvpx
    - --enable-libmp3lame
    sources: 
      - type: git
        url: https://git.ffmpeg.org/ffmpeg.git
        tag: n4.2.2
        
# libass -------------------------------------------------------------------------------
  - name: libass
    cleanup: [ /include, /lib/*.la, /lib/pkgconfig ]
    config-opts: [ --disable-static ]
    sources: 
    - type: git
      url: https://github.com/libass/libass
      tag: 0.14.0
      
# uchardet -------------------------------------------------------------------------------
  - name: uchardet
    buildsystem: cmake-ninja
    config-opts: [
    -DCMAKE_BUILD_TYPE=Release,
    -DBUILD_STATIC=0
    ]
    cleanup: [
    /bin,
    /include,
    /lib/pkgconfig,
    /share/man
    ]
    sources: 
      - type: git
        url: https://gitlab.freedesktop.org/uchardet/uchardet/
        tag: v0.0.6
